<!doctype html>

<html lang="en">
<head>
    <meta charset="utf-8">

    <title>Create invoice</title>
    <meta name="description" content="The HTML5 Herald">
    <meta name="author" content="SitePoint">

    <!--<link rel="stylesheet" href="css/styles.css?v=1.0">-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.13/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <!-- TOASTR -->
    <script src="https://unpkg.com/vue-toastr-2/dist/vue-toastr-2.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/vue-toastr-2/dist/vue-toastr-2.min.css">

</head>
<style>
    #app{position: relative}
    .animate1{position: relative; top: -30px; opacity: .0; z-index: -999}
    .animate11{position: relative; top: -70px; opacity: 0; z-index: -999}
    .animate2{position: relative; top: 0; opacity: 1;  -webkit-transition: opacity,top .6s; transition: opacity,top .6s; z-index: 1}
    .animate22{position: relative; top: 0; opacity: 1;  -webkit-transition: opacity,top .5s; transition: opacity,top .5s; z-index: 1}

    /****  LOADER: START  ****/
    .loader {
        border: 6px solid #ccc;
        border-radius: 50%;
        border-top: 6px solid #bf0021;
        width: 30px;
        height: 30px;
        -webkit-animation: spin 1s linear infinite; /* Safari */
        animation: spin 1s linear infinite;
    }

    /* Safari */
    @-webkit-keyframes spin {
        0% { -webkit-transform: rotate(0deg); }
        100% { -webkit-transform: rotate(360deg); }
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    /****  LOADER: END  ****/

</style>

<body>
    <div id="app">
        <!--<div class="row">-->
            <!--<ul>-->
                <!--<li v-for="p in invoice.products">{{p}}</li>-->
            <!--</ul>-->
        <!--</div>-->
        <!--<hr>-->
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-8 offset-md-2 mb-3z text-center">
                    <h1>{{title}}</h1>
                    <hr>
                </div>
                <div class="col-md-6 offset-md-2">
                    <div class="form-group animate1" :class="{'animate2': invoice.products.length > 0}" v-if="invoice.products.length > 0">
                        <button class="btn btn-primary btn-block" @click="onSubmit()" :disabled="loadingSubmit">
                            <span v-if="loadingSubmit">Creating invoice...</span>
                            <span v-else>Create invoice</span>
                        </button>
                    </div>
                    <div class="form-group row">
                        <label for="" class="col-md-4">client</label>
                        <input type="text" v-model="invoice.client.name" name="client_name" placeholder="client name" class="form-control col-md-8">
                    </div>
                    <div class="form-group row">
                        <label for="" class="col-md-4">phone</label>
                        <input type="phone" v-model="invoice.client.phone" name="client_phone" placeholder="phone" class="form-control col-md-8">
                    </div><!------------------------------------------>

                    <div class="form-group row animate1" :class="{'animate2': invoice.client.phone && invoice.client.name}">
                        <label for="" class="col-md-4">Item</label>
                        <input type="text" v-model="newProd.model" @keyup.enter="requestItemByModel()" name="item_model" placeholder="Model number.. press enter" class="form-control"
                               :class="{'col-md-7': loading, 'col-md-8': !loading}" data-toggle="tooltip" data-placement="right" title="Tooltip on ..">
                        <div class="col-md-1" v-if="loading"><div class="loader"></div></div>
                    </div>


                    <div class="animate11" :class="{'animate22': newProd.desc}">
                        <div class="form-group row" :class="{'animate2': invoice.client.model}">
                            <label for="" class="col-md-4">description</label>
                            <input type="text" v-model="newProd.desc" name="" placeholder="description" class="form-control col-md-8 item_model" disabled="disabled">
                        </div>
                        <div class="form-group row">
                            <label for="" class="col-md-4">price</label>
                            <input type="text" v-model="newProd.price" name="" placeholder="price" class="form-control col-md-8" disabled="disabled">
                        </div>
                        <div class="form-group row">
                            <label for="" class="col-md-4">quantity</label>
                            <input type="number" v-model="newProd.quantity" @keyup.enter="addProd()" name="" placeholder="quantity" class="form-control col-md-8">
                        </div><!------------------------------------------>

                        <div class="form-group">
                            <button class="btn btn-success" @click="addProd()"
                                    :disabled="!newProd.model || !newProd.price || !newProd.quantity">add product</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card card-outline-primary text-center" v-if="invoice.client.name">
                        <div class="card-block">
                            <p><strong>{{invoice.client.name}}</strong></p>
                            <p><strong>{{invoice.client.phone}}</strong></p>
                            <div v-if="invoice.products.length > 0">
                                <hr>
                                <p><strong>Items:</strong></p>
                                <ul v-for="item in invoice.products" class="text-left455+46+">
                                    <li>
                                        <p><span>{{item.model}}</span> <span>({{item.price}})</span></p>
                                    </li>
                                </ul>
                                <hr>
                                <p><strong>Total price: {{totalPrice}}</strong></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class Item {
            constructor(id, model, desc, price, quantity) {
                this.id = id
                this.model = model
                this.desc = desc
                this.price = price
                this.quantity = quantity
            }
        }
        class Client {
            constructor(name, phone) {
                this.name = name
                this.phone = phone
            }
        }
        class User {
            constructor(id, name) {
                this.id = id
                this.name = name
            }
        }

        var app = new Vue({
            el: '#app',
            data(){
                return {
                    title: 'Create invoice',
                    newProd: new Item(),
                    invoice: {
                        date: '',
                        client: new Client(),
                        user: new User(),
                        products: []
                    },
                    totalPrice: 0,
                    loading: false,
                    loadingSubmit: false
                }
            },
            methods: {
                addProd(){
                    this.invoice.products.unshift(this.newProd)
                    this.totalPrice += this.newProd.price
                    this.newProd = new Item()
                },
                requestItemByModel(){
                    this.loading = true
                    axios.post('https://jsonplaceholder.typicode.com/posts', this.newProd.model)
                        .then((response) => {
                            console.log(response.data)
                            //this.newProd = response.data
                            this.newProd.desc = 'toto'
                            this.newProd.price = 155
                            this.$toastr.success('Item found + item title');
                            this.loading = false
                        })
                        .catch((error) => {
                            this.$toastr.error('Please try again later.', 'Error reaching the item!');
                            this.loading = false
                        })
                },
                onSubmit(){
                    this.loadingSubmit = true
                    axios.post('https://jsonplaceholder.typicode.com/posts', this.invoice)
                        .then((response) => {
                            console.log(response.data)
                            this.invoice = {
                                date: '',
                                client: new Client(),
                                user: new User(),
                                products: []
                            }
                            this.totalPrice = 0
                            this.$toastr.success('Invoice was successfully created!');
                            this.loadingSubmit = false
                        })
                        .catch((error) => {
                            this.$toastr.error('Please try again later.', 'Error while creating the invoice!');
                            this.loadingSubmit = false
                        })
                }
            }
        })
    </script>

</body>
</html>